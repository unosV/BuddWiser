<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Tracker - Modern & Beautiful</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1>ğŸ’° Budget Tracker</h1>
            <div class="header-actions">
                <span class="username">Hi, {{ username }}!</span>
                <button class="manage-categories-btn" onclick="openCategoryManager()">
                    ğŸ“‚ Manage Categories
                </button>
                <a href="/logout" class="logout-btn">Logout</a>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        
        <!-- Month Selector -->
        <div class="month-selector">
            <label for="monthInput">ğŸ“… Month:</label>
            <input type="month" id="monthInput" class="month-input">
        </div>

        <!-- Monthly Overview Card -->
        <div class="overview-card">
            <div class="overview-header">
                <h2>November 2024</h2>
                <button class="edit-income-btn" onclick="editIncome()">âœï¸ Edit Income</button>
            </div>
            
            <div class="overview-stats">
                <div class="stat">
                    <div class="stat-label">Income</div>
                    <div class="stat-value" id="incomeValue">$0.00</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Spent</div>
                    <div class="stat-value danger" id="spentValue">$0.00</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Remaining</div>
                    <div class="stat-value success" id="remainingValue">$0.00</div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="progress-label" id="progressLabel">0% spent</div>
            </div>

            <!-- Top Spending Categories -->
            <div class="top-categories" id="topCategories">
                <h3>Top Spending</h3>
                <div class="category-list" id="topCategoryList">
                    <p class="empty-state">No expenses yet</p>
                </div>
                <button class="view-all-btn" onclick="viewAllCategories()" id="viewAllBtn" style="display: none;">
                    View All Categories â†’
                </button>
            </div>

            <div class="last-updated" id="lastUpdated">
                Last updated: Never
            </div>
        </div>

        <!-- Week Calendar -->
        <div class="week-calendar-card">
            <h3>ğŸ“… This Week</h3>
            <div class="week-calendar" id="weekCalendar">
                <!-- Generated by JS -->
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <div class="chart-card">
                <h3>ğŸ’¸ Spending Breakdown</h3>
                <canvas id="categoryChart"></canvas>
            </div>
            <div class="chart-card">
                <h3>ğŸ“Š Income vs Expenses</h3>
                <canvas id="budgetChart"></canvas>
            </div>
        </div>

        <!-- Trends Chart -->
        <div class="chart-card-full">
            <h3>ğŸ“ˆ 3-Month Trend</h3>
            <canvas id="trendChart"></canvas>
        </div>

        <!-- Transactions List -->
        <div class="transactions-card">
            <h3>ğŸ“ Recent Transactions</h3>
            <div class="transactions-list" id="transactionsList">
                <p class="empty-state">No transactions yet. Add your first expense!</p>
            </div>
        </div>

    </div>

    <!-- Floating Add Button -->
    <button class="fab" onclick="openAddModal()">
        <span class="fab-icon">+</span>
    </button>

    <!-- Add Transaction Modal -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Expense</h2>
                <button class="close-btn" onclick="closeAddModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>ğŸ’µ Amount</label>
                    <input type="number" id="amountInput" placeholder="0.00" step="0.01" min="0" required autofocus>
                </div>
                <div class="form-group">
                    <label>ğŸ“ Category</label>
                    <select id="categoryInput" required>
                        <!-- Generated by JS -->
                    </select>
                </div>
                <div class="form-group">
                    <label>ğŸª Description (Optional)</label>
                    <input type="text" id="descriptionInput" placeholder="e.g., Woolworths, Uber, Netflix">
                </div>
                <div class="form-group">
                    <label>ğŸ“… Date</label>
                    <input type="date" id="dateInput" required>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAddModal()">Cancel</button>
                <button class="btn btn-primary" onclick="addTransaction()">Add Expense</button>
            </div>
        </div>
    </div>

    <!-- Edit Income Modal -->
    <div class="modal" id="incomeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Set Monthly Income</h2>
                <button class="close-btn" onclick="closeIncomeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>ğŸ’° Monthly Income</label>
                    <input type="number" id="incomeInputModal" placeholder="0.00" step="0.01" min="0" required>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeIncomeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveIncome()">Save Income</button>
            </div>
        </div>
    </div>

    <!-- Category Breakdown Modal -->
    <div class="modal" id="categoryModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>All Categories</h2>
                <button class="close-btn" onclick="closeCategoryModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="allCategoriesList">
                    <!-- Generated by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Category Manager Modal (NEW!) -->
    <div class="modal" id="categoryManagerModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>ğŸ“‚ Manage Categories</h2>
                <button class="close-btn" onclick="closeCategoryManager()">&times;</button>
            </div>
            <div class="modal-body">
                
                <!-- Default Categories Section -->
                <h3 style="margin-bottom: 1rem;">Default Categories</h3>
                <div id="defaultCategoriesList" class="categories-grid">
                    <!-- Generated by JS -->
                </div>
                
                <!-- Custom Categories Section -->
                <h3 style="margin-top: 2rem; margin-bottom: 1rem;">Your Custom Categories</h3>
                <div id="customCategoriesList" class="categories-grid">
                    <p class="empty-state">No custom categories yet. Add one below!</p>
                </div>
                
                <!-- Divider -->
                <hr style="margin: 2rem 0; border: none; border-top: 2px solid var(--border);">
                
                <!-- Add New Category Form -->
                <h3 style="margin-bottom: 1rem;">âœ¨ Add New Category</h3>
                <div class="add-category-form">
                    <div class="form-group">
                        <label>ğŸ“ Category Name</label>
                        <input type="text" id="newCategoryName" placeholder="e.g., Pets, Gaming, Education" maxlength="50">
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label>ğŸ˜€ Emoji Icon</label>
                            <input type="text" id="newCategoryIcon" placeholder="ğŸ•" maxlength="2" style="font-size: 1.5rem; text-align: center;">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>ğŸ¨ Color</label>
                            <input type="color" id="newCategoryColor" value="#36A2EB">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="addNewCategory()" style="width: 100%;">
                        âœ¨ Add Category
                    </button>
                </div>
                
                <!-- Help Text -->
                <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg); border-radius: var(--radius-md); font-size: 0.9rem; color: var(--text-light);">
                    <strong>ğŸ’¡ Tips:</strong>
                    <ul style="margin: 0.5rem 0 0 1.5rem;">
                        <li>You can only delete categories that aren't being used in transactions</li>
                        <li>Choose a unique emoji and color to make your category easy to spot</li>
                        <li>Custom categories appear in the dropdown when adding expenses</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
